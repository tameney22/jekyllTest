<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>folio 11v</title>
    <link rel="stylesheet" href="/jekyllTest/assets/css/CETEIcean.css">
    <link rel="stylesheet" href="/jekyllTest/assets/css/main.css">
    <link href='https://fonts.googleapis.com/css?family=Oswald:400,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Barlow+Semi+Condensed" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="/jekyllTest/assets/scripts/modernizr.custom.js"></script>
    <script src="/jekyllTest/assets/js/CETEI.js"></script>
</head>
<style>
  @keyframes blink {
    0%   {background-color:yellow;}
    50% {background-color: white;}
    100% {background-color:yellow;}
  }

  #highlight {
    background-color: yellow;
    animation-name: blink;
    animation-duration: 2s;
    animation-iteration-count: 3;
  }

</style>

<body>

<header role="banner" class="page-header" id="top">
<div class="headerleft">
<h1 id="site-title"><a href="https://yosephtamene.com/jekyllTest" class="site-title">Huon d'Auvergne Digital Archive</a></h1>


</div>
<div class="headerright">
<nav class="site-nav">  
  
 
  <div class="dropdown">
    <button class="dropbtn">About <i class="fa fa-caret-down"></i> </button>
      <div class="dropdown-content">
        
          <a href="/about/versioning.html">Versioning</a>
        
          <a href="/about/bibliography.html">Bibliography</a>
        
          <a href="/about/citation.html">Cite our work</a>
        
          <a href="https://github.com/SteveWLU/hda">Source Code</a>
        
          <a href="/about/technical-notes.html">Technical Notes</a>
        
      
    </div>
  </div>

  
 
  <div class="dropdown">
    <button class="dropbtn">Praxis <i class="fa fa-caret-down"></i> </button>
      <div class="dropdown-content">
        
          <a href="/test-praxis.html">General Criteria</a>
        
          <a href="/b-praxis.html">Berlin Criteria</a>
        
          <a href="/t-praxis.html">Turin Criteria</a>
        
          <a href="/p-praxis.html">Padua Criteria</a>
        
          <a href="/br-praxis.html">Barbieri Fragment Criteria</a>
        
      
    </div>
  </div>

  
 
  <div class="dropdown">
    <button class="dropbtn">Editions <i class="fa fa-caret-down"></i> </button>
      <div class="dropdown-content">
        
          <a href="/editions/b-intro.html">Berlin (B)</a>
        
          <a href="/editions/t-intro.html">Turin (T)</a>
        
          <a href="/editions/p-intro.html">Padua (P)</a>
        
          <a href="/editions/br-intro.html">Barbieri Fragment (Br)</a>
        
      
    </div>
  </div>

  
 
  <div class="dropdown">
    <button class="dropbtn">Translation <i class="fa fa-caret-down"></i> </button>
      <div class="dropdown-content">
        
          <a href="/editions/bt-intro.html">Berlin Translation</a>
        
      
    </div>
  </div>

  
 
  <div class="dropdown">
    <button class="dropbtn">Search <i class="fa fa-caret-down"></i> </button>
      <div class="dropdown-content">
        
          <a href="/search/">Search Anywhere!</a>
        
      
    </div>
  </div>

  
</nav> 

</div>
<div class="headerleft">
<p>A digital edition of Huon d'Auvergne, a pre-modern, Franco-Italian Epic</p>
</div>
</header>
<main class="page-content" aria-label="Content">
<!-- edition controls --> 
<div class="flex-container" id="TEI-tools">

<div class="flex-item" id="mstitle">
  <h1>Bologna, Biblioteca Comunale dell'Archiginnasio, MS B. 3489</h1>
</div>

<!-- Liquid code for transcription and folio navigation -->
 <div class="flex-item" id="folio-nav">

  
  



    <!-- from rails site-->
    <!-- <form id="rajna-form">
    <label for="rajnaCheckbox" id="rajna-label"> Rajna Notebook</label>
    <input type="checkbox" name="rajnaCheckbox" id="rajnaCheckbox" style="display: inline;">
    </form> -->


  <!-- HTML for transcription and folio navigation -->
 
  <a href="/jekyllTest/br-edition/br-edition-011r.html" class="prev">&#8617;</a>
  folio 11v
  <a href="/jekyllTest/br-edition/br-edition-012r.html" class="next">&#8618;</a>


</div>

<div id="tools">


  <div id="expand">
      <label class="switch">
          <input type="checkbox" name="abbreviations-toggle" checked>
          <div class="slider round"></div>
      </label> Expand Abbreviations
  </div>

  <div id="notes">
      <label class="switch">
          <input type="checkbox" name="notes" checked>
          <div class="slider round"></div>
      </label> Notes
  </div>

  <div id="source-code">
      <a href="https://github.com/SteveWLU/hda/blob/development/editions/p.xml"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username"></span>Source Code</a>
  </div>
 
  <!-- Insert Status Update from TEI header <change> tag (line 213) -->
  <div id="status"></div>

</div>
</div>

<div id="edition-viewer">

  
  <!-- Insert TEI Content-->
  <div id="TEI" data-milestone="22"></div>

  <!-- Insert OpenSeaDragon viewer and content -->
  <div id="openseadragon1"></div>

</div>
<script src="/jekyllTest/assets/js/openseadragon/openseadragon.min.js"></script>

<script type="text/javascript">
    var viewer = OpenSeadragon({
        id: "openseadragon1",
        minZoomImageRatio: 1,
        prefixUrl: "/assets/openseadragon/images/",
        tileSources: "https://iiif.wlu.edu/iiif/huon/br011v.tif/info.json"
 
    });

</script>


<div id="edition-notes" data-milestone="22">
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<script>
  // ADD LINE NUMBERS
  
  // CODE TO HIDE A PAGE
  function showPage(page) {
    // Hide all text that does not belong to the page indicated
    var n
    var pbs = 0
    var hide = false

    // First, remove all hiding CSS classes, if present.
    Array.from(document.querySelectorAll('.hid_page')).map(function (el) {
      el.classList.remove('hid_page')
    })

    // Walk trough all descendants of tei-text
    var walk = document.createTreeWalker(document.querySelector('tei-text'), NodeFilter.SHOW_ALL, null, false)
    while (n = walk.nextNode()) {
      if (n.nodeType === Node.ELEMENT_NODE) {
        //  If this is a page beginning, update page count.
        //  If page count is lower or higher than the page requested, set 'hide' flag.
        //  If page count corresponds to the page requested, remove 'hide' flag.
        if (n.localName === 'tei-milestone' ) {
          pbs++
          if (pbs != page) {
            hide = true
          } else {
            hide = false
          }
        }

        // If the hide flag is set and this is an empty element, hide it just in case the
        // CETEIcean CSS (or other) does something with it.
        if (hide && n.childNodes.length === 0) {
          n.classList.add('hid_page')
        }
        //RAFF 10/19 just this if statement
        if (hide && n.tagName === 'tei-note') {
           n.classList.add('hid_note')
        }

      } else if (n.nodeType === Node.TEXT_NODE) {
        // We mostly operate at text node level by storing and restoring text data.

        // Start by always restoring text data is previously removed.
        if (n.storedContent) {
          n.textContent = n.storedContent
        }

        // If the 'hide' flag is set, store text content and remove it.
        if (hide) {
          n.storedContent = n.textContent
          n.textContent = ''
        }
      }
    }
  }


// CODE TO RUN CETEICEAN
var CETEIcean = new CETEI()

  CETEIcean.getHTML5("/jekyllTest/editions/br.xml", function(data) {



  document.getElementById("TEI").innerHTML = ""
  document.getElementById("TEI").appendChild(data)
  CETEIcean.addStyle(document, data)

  // Get status from TEI header <change> tag and place in the update div (line 96)
  var update = data.querySelector("tei-change")
    document.getElementById("status").innerHTML = ""
    document.getElementById("status").appendChild(update)
    CETEIcean.addStyle(document, data)

  //get current page
  const currentMilestone = document.getElementById("TEI").getAttribute("data-milestone");

  //show current page
  showPage(currentMilestone)

 

// to show notes
var CETEIceanNotes = new CETEI()

  CETEIceanNotes.getHTML5("/jekyllTest/editions/notes-br.xml", function(data) {


  //document.getElementById("edition-notes").innerHTML = ""
  //document.getElementById("edition-notes").appendChild(data)
  //CETEIceanNotes.addStyle(document, data)

 // to get note IDs RAFF 10/19
  var visible_ids = Array.from(document.querySelectorAll('#TEI  tei-note:not(.hid_page')).map(function(n) {return n.getAttribute('xml:id')})

/// Raff 10/19
    visible_ids.forEach(function (id) {
      if (id){
        var note = data.querySelector('tei-note[target="#'+ id +'"]')
        document.getElementById('edition-notes').appendChild(note)
        console.log(note)
      }
    });

  });

});

//Variables for toggle buttons
var options = {
        "rajna_reconstruction":false,
        "expanded_abbreviations":true,
        "show_french":true,
        "notes":true
    };

 //Function to toggle abbreviations
 $("input[name='abbreviations-toggle'").change(function(){
      $("tei-choice").each(function(){
        $(this).children("tei-ex").toggle();
        $(this).children("tei-abbr").toggle();
      })
      options.expanded_abbreviations = $(this).is(":checked");
    });

//Function to toggle rajna reconstruction
$("input[name='rajna-reconstruction'").change(function(){
  options.rajna_reconstruction = $(this).is(":checked");
  if(options.rajna_reconstruction){
    $("tei-seg").css("color", "red");
  } else {
    $("tei-seg").css("color", "black");
  }
});

//Function to show french
$("input[name='show-french'").change(function(){
  options.show_french = $(this).is(":checked");
  if(options.show_french){
    $("tei-span").css("color", "blue");
  } else {
    $("tei-span").css("color", "black");
  }
});

// Function to turn notes div on/off 
$("input[name='notes'").change(function(){
  $("#edition-notes").toggle();
  });

  // The following is for the search result scrolling to the line
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const lineNum = urlParams.get('lineNum');

  // Check every 100ms if element exists before trying to highlight and scroll to it
  var checkExist = setInterval(function() {
   if ($(`tei-l[n="${lineNum}"]`).length) {
      if (lineNum) {
        const lineText = $(`tei-l[n="${lineNum}"]`).html();
        
        $('html, body').animate({
          scrollTop: $(`tei-l[n="${lineNum}"]`).offset().top
        }, 'slow');
        
        $(`tei-l[n="${lineNum}"]`).html(`<span id="highlight">${lineText}</span>`);
      }
      clearInterval(checkExist);
   }
}, 100); 
    

</script>

</div>
</main>
</body>
</html>